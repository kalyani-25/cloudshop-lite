server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    # ---------- Frontend (React/Vite SPA) ----------
    location / {
        try_files $uri /index.html;
    }

    # ---------- Backend APIs ----------

    # Users microservice  (GET /users)
    location /users/ {
        proxy_pass http://users-service:5000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Catalog microservice (GET /catalog/products)
    location /catalog/ {
        proxy_pass http://catalog-service:5001/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Orders microservice (GET /orders)
    location /orders/ {
        proxy_pass http://orders-service:5002/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # ---------- AI-Ops Bot (CloudWatch) ----------
    #
    # From OUTSIDE you will call:
    #   GET /ai/health
    #   GET /ai/logs/summary?minutes=60

    # Exact match for /ai/health
    location = /ai/health {
        proxy_pass http://aiops-bot-service:5100/ai/health;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Exact match for /ai/logs/summary
    # Query string (minutes=60) is preserved automatically.
    location = /ai/logs/summary {
        proxy_pass http://aiops-bot-service:5100/ai/logs/summary;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
